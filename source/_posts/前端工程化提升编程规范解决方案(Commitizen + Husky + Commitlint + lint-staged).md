---
cover: https://source.unsplash.com/random/?git
title: å‰ç«¯å·¥ç¨‹åŒ–ç¼–ç¨‹è§„èŒƒè§£å†³æ–¹æ¡ˆ(Commitizen + Husky + Commitlint + lint-staged)
description: >-
  å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸æ˜¯ä»¥ä¸€ä¸ªå›¢é˜Ÿä¸ºå•ä½å»å¼€å‘ï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„ä»£ç é£æ ¼ï¼Œæˆ–è€…æ—¶å¸¸ä¼šæœ‰æ–°çš„åŒå­¦è¿›å…¥å›¢é˜Ÿï¼Œä¸ç†Ÿæ‚‰å›¢é˜Ÿçš„ä»£ç è¦æ±‚ï¼Œè¯¯æä¸åˆè§„çš„ä»£ç ã€‚äººå·¥reviewæ—¶å¸¸ä¼šæœ‰ç–æ¼ï¼Œå› æ­¤éœ€è¦ä¸€äº›å·¥å…·æ¥è§„èŒƒæˆ–è€…è‡ªåŠ¨åŒ–reviewã€‚
tags:
  - git
  - ä»£ç è§„èŒƒ
  - å‰ç«¯å·¥ç¨‹
categories:
  - æŠ€æœ¯åˆ†äº«
swiper_index: 4 #ç½®é¡¶è½®æ’­å›¾é¡ºåºï¼Œéè´Ÿæ•´æ•°ï¼Œæ•°å­—è¶Šå¤§è¶Šé å‰
abbrlink: 56c169c
date: 2023-01-16 21:12:23
---

å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸æ˜¯ä»¥ä¸€ä¸ªå›¢é˜Ÿä¸ºå•ä½å»å¼€å‘ï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„ä»£ç é£æ ¼ï¼Œæˆ–è€…æ—¶å¸¸ä¼šæœ‰æ–°çš„åŒå­¦è¿›å…¥å›¢é˜Ÿï¼Œä¸ç†Ÿæ‚‰å›¢é˜Ÿçš„ä»£ç è¦æ±‚ï¼Œè¯¯æä¸åˆè§„çš„ä»£ç ã€‚äººå·¥reviewæ—¶å¸¸ä¼šæœ‰ç–æ¼ï¼Œå› æ­¤éœ€è¦ä¸€äº›å·¥å…·æ¥è§„èŒƒæˆ–è€…è‡ªåŠ¨åŒ–reviewã€‚

# commitè§„èŒƒ

## commitizen

`commitizen` æä¾›commitæ¨¡ç‰ˆï¼Œç”¨æˆ·ä¸€æ­¥æ­¥å¡«å†™åç”Ÿæˆæœ€ç»ˆçš„commitä¿¡æ¯ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è§„èŒƒåŒ–git commitçš„æäº¤, å®‰è£…`commitizen`åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`git cz`æ¥ä»£æ›¿`git commit`ã€‚

[Commitizen github](https://github.com/commitizen/cz-cli 'commitizen github').

1. å…¨å±€å®‰è£…`Commitizen`
```bash
npm install -g commitizen@4.2.4
```

2. é¡¹ç›®å†…å®‰è£…å¹¶é…ç½® cz-customizable æ’ä»¶
    a. ä½¿ç”¨ npm ä¸‹è½½ cz-customizable
    ```bash
    npm i cz-customizable@6.3.0 --save-dev
    ```
    b. æ·»åŠ ä»¥ä¸‹é…ç½®åˆ° `package.json` ä¸­
    ```bash
      "config": {
        "commitizen": {
          "path": "node_modules/cz-customizable"
        }
      }
    ```
    c. é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `.cz-config.js` è‡ªå®šä¹‰æç¤ºæ–‡ä»¶
    ```js
    module.exports = {
        // å¯é€‰ç±»å‹
        types: [
            { value: ':sparkles: feat', name: 'âœ¨ feat:     æ–°åŠŸèƒ½' },
            { value: ':bug: fix', name: 'ğŸ› fix:      ä¿®å¤' },
            { value: ':zap: perf', name: 'âš¡ perf:     æ€§èƒ½ä¼˜åŒ–' },
            {
                value: ':rocket: chore',
                name: 'ğŸš€ chore:    æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨',
            },
            { value: ':tada: init', name: 'ğŸ‰ init:     åˆå§‹åŒ–' },
            { value: ':memo: docs', name: 'ğŸ“ docs:     æ–‡æ¡£å˜æ›´' },
            {
                value: ':lipstick: style',
                name: 'ğŸ’„ style:    ä»£ç æ ¼å¼(ä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨)',
            },
            {
                value: ':recycle: refactor',
                name: 'â™»ï¸ refactor: é‡æ„(æ—¢ä¸æ˜¯å¢åŠ featureï¼Œä¹Ÿä¸æ˜¯ä¿®å¤bug)',
            },
            { value: ':white_check_mark: test', name: 'âœ… test:     å¢åŠ æµ‹è¯•' },
            { value: ':rewind: revert', name: 'âªï¸ revert:   å›é€€' },
            { value: ':package: build', name: 'ğŸ“¦ï¸ build:    æ‰“åŒ…' },
        ],
        messages: {
            type: 'è¯·é€‰æ‹©æäº¤ç±»å‹:',
            customScope: 'è¯·è¾“å…¥ä¿®æ”¹èŒƒå›´(å¯é€‰):',
            subject: 'è¯·ç®€è¦æè¿°æäº¤(å¿…å¡«):',
            body: 'è¯·è¾“å…¥è¯¦ç»†æè¿°(å¯é€‰):',
            footer: 'è¯·è¾“å…¥è¦å…³é—­çš„issue(å¯é€‰):',
            confirmCommit: 'ç¡®è®¤ä½¿ç”¨ä»¥ä¸Šä¿¡æ¯æäº¤ï¼Ÿ(y/n/e/h)',
        },
        // è·³è¿‡é—®é¢˜
        skipQuestions: ['body', 'footer'],
        // subjectæ–‡å­—é•¿åº¦é»˜è®¤æ˜¯72
        subjectLimit: 100,
    };
    ```
    
    d. ä½¿ç”¨ `git cz` ä»£æ›¿ `git commit`ï¼Œå³å¯çœ‹åˆ°æç¤ºå†…å®¹ 

é‚£ä¹ˆåˆ°è¿™é‡Œå°±å·²ç»å¯ä»¥ä½¿ç”¨`git cz` æ¥ä»£æ›¿äº† `git commit` å®ç°äº†è§„èŒƒåŒ–çš„æäº¤è¯‰æ±‚äº†ï¼Œä½†æ˜¯å½“å‰ä¾ç„¶å­˜åœ¨ç€ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬å¿…é¡»è¦é€šè¿‡ `git cz` æŒ‡ä»¤æ‰å¯ä»¥å®Œæˆè§„èŒƒåŒ–æäº¤ï¼
é‚£ä¹ˆå¦‚æœæœ‰é©¬è™çš„äººï¼Œä»–ä»¬å¿˜è®°äº†ä½¿ç”¨ `git cz` æŒ‡ä»¤ï¼Œç›´æ¥å°±æäº¤äº†æ€ä¹ˆåŠå‘¢ï¼Ÿ
é‚£ä¹ˆæœ‰æ²¡æœ‰æ–¹å¼æ¥é™åˆ¶è¿™ç§é”™è¯¯çš„å‡ºç°å‘¢ï¼Ÿ
ç­”æ¡ˆæ˜¯ **Git Hooksï¼**

# Git Hooks

è€Œè¦å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬å°±éœ€è¦å…ˆæ¥äº†è§£ä¸€ä¸ªæ¦‚å¿µï¼Œå«åš `Git hooks`ï¼ˆgit é’©å­ || git å›è°ƒæ–¹æ³•ï¼‰
ä¹Ÿå°±æ˜¯ï¼šgit åœ¨æ‰§è¡ŒæŸä¸ªäº‹ä»¶ä¹‹å‰æˆ–ä¹‹åè¿›è¡Œä¸€äº›å…¶ä»–é¢å¤–çš„æ“ä½œ.
è€Œæˆ‘ä»¬æ‰€æœŸæœ›çš„ é˜»æ­¢ä¸åˆè§„çš„æäº¤æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨åˆ° hooks çš„é’©å­å‡½æ•°ã€‚

æ•´ä½“çš„ hooks éå¸¸å¤šï¼Œå½“æ—¶æˆ‘ä»¬å…¶ä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„å…¶å®åªæœ‰ä¸¤ä¸ªï¼š
|  Git Hook	   | è°ƒç”¨æ—¶æœº	  | è¯´æ˜  |
|  ----  | ----  |  ----  |
| pre-commit	  | `git commit`æ‰§è¡Œå‰ å®ƒä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œå¹¶ä¸”åœ¨è·å–æäº¤æ—¥å¿—æ¶ˆæ¯å¹¶è¿›è¡Œæäº¤ä¹‹å‰è¢«è°ƒç”¨ã€‚è„šæœ¬`git commit`ä»¥éé›¶çŠ¶æ€é€€å‡ºä¼šå¯¼è‡´å‘½ä»¤åœ¨åˆ›å»ºæäº¤ä¹‹å‰ä¸­æ­¢ã€‚ | å¯ä»¥ç”¨ `git commit --no-verify` ç»•è¿‡ |
| commit-msg	  | `git commit`æ‰§è¡Œå‰ å¯ç”¨äºå°†æ¶ˆæ¯è§„èŒƒåŒ–ä¸ºæŸç§é¡¹ç›®æ ‡å‡†æ ¼å¼ã€‚è¿˜å¯ç”¨äºåœ¨æ£€æŸ¥æ¶ˆæ¯æ–‡ä»¶åæ‹’ç»æäº¤ã€‚ | å¯ä»¥ç”¨ `git commit --no-verify` ç»•è¿‡ |

1. commit-msgï¼šå¯ä»¥ç”¨æ¥è§„èŒƒåŒ–æ ‡å‡†æ ¼å¼ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰éœ€æŒ‡å®šæ˜¯å¦è¦æ‹’ç»æœ¬æ¬¡æäº¤
2. pre-commitï¼šä¼šåœ¨æäº¤å‰è¢«è°ƒç”¨ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰éœ€æŒ‡å®šæ˜¯å¦è¦æ‹’ç»æœ¬æ¬¡æäº¤ã€‚

æˆ‘ä»¬äº†è§£äº† `git hooks` çš„æ¦‚å¿µï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä½¿ç”¨ `git hooks` æ¥å»æ ¡éªŒæˆ‘ä»¬çš„æäº¤ä¿¡æ¯ã€‚

# commintlint & husky

è¦å®Œæˆè¿™ä¹ˆä¸ªç›®æ ‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸¤ä¸ªå·¥å…·ï¼š

1. commitlintï¼šç”¨äºæ£€æŸ¥æäº¤ä¿¡æ¯

2. huskyï¼šæ˜¯git hookså·¥å…·

## commitlint
  a. ä½¿ç”¨ npm ä¸‹è½½ commitlint 
  ```bash
  npm i @commitlint/cli@17.4.0 --save-dev
  npm i @commitlint/config-conventional@12.1.4 --save-dev
  ```

  b. ä½¿ç”¨ npm ä¸‹è½½ commitlint emoji æ’ä»¶
  ```bash
  npm i commitlint-config-cz@0.13.3 --save-dev
  npm i commitlint-config-git-commit-emoji@1.0.0 --save-dev
  ```

  c. é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `commitlint.config.js` commitlint é…ç½®æ–‡ä»¶
  ```js
    module.exports = {
      // ç»§æ‰¿çš„è§„åˆ™
      extends: ['git-commit-emoji', 'cz']
      // å®šä¹‰è§„åˆ™ç±»å‹
      // å®šä¹‰è§„åˆ™ç±»å‹
      // rules: {
      //     // type ç±»å‹å®šä¹‰ï¼Œè¡¨ç¤º git æäº¤çš„ type å¿…é¡»åœ¨ä»¥ä¸‹ç±»å‹èŒƒå›´å†…
      //     // 'type-enum': [
      //     //     // å½“å‰éªŒè¯çš„é”™è¯¯çº§åˆ«
      //     //     2,
      //     //     // åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¿›è¡ŒéªŒè¯
      //     //     'always',
      //     //     // æ³›å‹å†…å®¹
      //     //     [
      //     //         ':sparkles: feat', // æ–°åŠŸèƒ½ feature
      //     //         ':bug: fix', // ä¿®å¤ bug
      //     //         ':memo: docs', // æ–‡æ¡£æ³¨é‡Š
      //     //         ':lipstick: style', // ä»£ç æ ¼å¼(ä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨)
      //     //         ':recycle: refactor', // é‡æ„(æ—¢ä¸å¢åŠ æ–°åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®å¤bug)
      //     //         ':zap: perf', // æ€§èƒ½ä¼˜åŒ–
      //     //         ':white_check_mark: test', // å¢åŠ æµ‹è¯•
      //     //         ':rocket: chore', // æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
      //     //         ':rewind: revert', // å›é€€
      //     //         ':package: build', // æ‰“åŒ…
      //     //         ':tada: init' // æ‰“åŒ…
      //     //     ]
      //     // ],
      //     // subject å¤§å°å†™ä¸åšæ ¡éªŒ
      //     // 'subject-case': [0]
      //     // 'subject-exclamation-mark': [0]
      // }
  };
  ```

## husky
  a. ä½¿ç”¨ npm ä¸‹è½½ husky
  ```bash
  npm install husky@7.0.1 --save-dev
  ``` 
  b. å¯åŠ¨ `hooks` ï¼Œ ç”Ÿæˆ `.husky` æ–‡ä»¶å¤¹
  ```bash
  npx husky install
  ```
  c. æ·»åŠ  `commitlint` çš„ hook åˆ° `husky` ä¸­ï¼Œå¹¶æŒ‡ä»¤åœ¨ `commit-msg` çš„ hooks ä¸‹æ‰§è¡Œ `npx --no-install commitlint --edit "$1"` æŒ‡ä»¤
  ```bash
  npx husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'
  ```
  

è‡³æ­¤ï¼Œå°±å·²ç»å¯ä»¥å¤„ç†å¥½äº† **å¼ºåˆ¶è§„èŒƒåŒ–çš„æäº¤è¦æ±‚**ï¼Œåˆ°ç°åœ¨ ä¸ç¬¦åˆè§„èŒƒçš„æäº¤ä¿¡æ¯ï¼Œå°†ä¸å¯åœ¨è¢«æäº¤ï¼
é‚£ä¹ˆåˆ°è¿™é‡Œæˆ‘ä»¬çš„ è§„èŒƒåŒ–ç›®æ ‡ å°±å®Œæˆäº†å—ï¼Ÿ
å½“ç„¶æ²¡æœ‰ï¼
ç°åœ¨æˆ‘ä»¬è¿˜ç¼ºå°‘ä¸€ä¸ª **è§„èŒƒåŒ–çš„å¤„ç†** ï¼Œé‚£å°±æ˜¯ **ä»£ç æ ¼å¼æäº¤è§„èŒƒå¤„ç†ï¼**

# lint-staged

`ESLint` ä¸ `Prettier` é…åˆå¯ä»¥è§£å†³ä»£ç æ ¼å¼é—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ ¼å¼å¤„ç†é—®é¢˜ï¼Œä»–åªèƒ½å¤Ÿåœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜éœ€è¦ æ‰‹åŠ¨åœ¨ VSCode ä¸­é…ç½®è‡ªåŠ¨ä¿å­˜ æ‰å¯ä»¥ã€‚é‚£ä¹ˆè¿™æ ·å°±ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œè¦æ˜¯æœ‰äººå¿˜è®°é…ç½®è¿™ä¸ªä¸œè¥¿äº†æ€ä¹ˆåŠå‘¢ï¼Ÿä»–æŠŠä»£ç å†™çš„ä¹±ä¸ƒå…«ç³Ÿçš„ç›´æ¥å°±æäº¤äº†æ€ä¹ˆåŠå‘¢ï¼Ÿ

æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ç§æ–¹å¼æ¥è§„é¿è¿™ç§é£é™©ã€‚

é‚£ä¹ˆæƒ³è¦å®Œæˆè¿™ä¹ˆä¸€ä¸ªæ“ä½œå°±éœ€è¦ä½¿ç”¨ `husky` é…åˆ `eslint` æ‰å¯ä»¥å®ç°ã€‚

æˆ‘ä»¬æœŸæœ›é€šè¿‡ `husky` ç›‘æµ‹ `pre-commit` é’©å­ï¼Œåœ¨è¯¥é’©å­ä¸‹æ‰§è¡Œç±»ä¼¼ `npx eslint --ext .js,.vue src` ä¸€äº›æŒ‡ä»¤æ¥å»è¿›è¡Œç›¸å…³æ£€æµ‹ã€‚

`lint-staged` å¯ä»¥è®©ä½ å½“å‰çš„ä»£ç æ£€æŸ¥ **åªæ£€æŸ¥æœ¬æ¬¡ä¿®æ”¹æ›´æ–°çš„ä»£ç ï¼Œå¹¶åœ¨å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œè‡ªåŠ¨ä¿®å¤å¹¶ä¸”æ¨é€ã€‚**

  a. ä½¿ç”¨ npm ä¸‹è½½ lint-stagedï¼Œ`lint-staged` å¯ä»¥åœ¨commitå‰æ‰§è¡Œæ“ä½œ
  ```bash
  npm install lint-staged@13.1.0 --save-dev
  ```
  b. åœ¨ `package.json` ä¸­æ·»åŠ  `lint-staged` é’©å­
  ```bash
  "lint-staged": {
    "src/**/*.{js,vue}": [
      "eslint --fix",
      "git add"
    ]
  }
  ```
  c. æ·»åŠ  `commitlint` çš„ hook åˆ° `husky` ä¸­ï¼Œå¹¶æŒ‡ä»¤åœ¨ `pre-commit` çš„ hooks ä¸‹æ‰§è¡Œ `npx lint-staged` æŒ‡ä»¤
  ```bash
  npx husky add .husky/pre-commit 'npx lint-staged'
  ```

å¦‚ä¸Šé…ç½®ï¼Œæ¯æ¬¡å®ƒåªä¼šåœ¨ä½ æœ¬åœ° `commit` ä¹‹å‰ï¼Œæ ¡éªŒä½ æäº¤çš„å†…å®¹æ˜¯å¦ç¬¦åˆä½ æœ¬åœ°é…ç½®çš„ `eslint`è§„åˆ™(è¿™ä¸ªè§æ–‡æ¡£ ESLint )ï¼Œæ ¡éªŒä¼šå‡ºç°ä¸¤ç§ç»“æœï¼š
  a. å¦‚æœç¬¦åˆè§„åˆ™ï¼šåˆ™ä¼šæäº¤æˆåŠŸã€‚
  b. å¦‚æœä¸ç¬¦åˆè§„åˆ™ï¼šå®ƒä¼šè‡ªåŠ¨æ‰§è¡Œ `eslint --fix` å°è¯•å¸®ä½ è‡ªåŠ¨ä¿®å¤ï¼Œå¦‚æœä¿®å¤æˆåŠŸåˆ™ä¼šå¸®ä½ æŠŠä¿®å¤å¥½çš„ä»£ç æäº¤ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™ä¼šæç¤ºä½ é”™è¯¯ï¼Œè®©ä½ ä¿®å¥½è¿™ä¸ªé”™è¯¯ä¹‹åæ‰èƒ½å…è®¸ä½ æäº¤ä»£ç ã€‚


# æ€»ç»“

`commitizen` å·²ç»æ˜¯ç›®å‰ä½œä¸º git æäº¤è§„èŒƒä¸­æœ€ä¼˜ç§€çš„å·¥å…·ä¹‹ä¸€äº†ã€‚åœ¨å›¢é˜Ÿå¼€å‘ä¸­ï¼Œä¸€èˆ¬ç»“åˆ `Eslint` å’Œ `Prettier` å·¥å…·ä¸€èµ·ä½¿ç”¨ï¼Œé…åˆ `husky` å’Œ `commitlint` é’©å­ï¼Œåšæäº¤å‰çš„ä»£ç æ£€æµ‹ï¼Œåšåˆ°è‡ªåŠ¨åŒ–ç¬¦åˆå›¢é˜Ÿä»£ç è§„èŒƒï¼Œå…»æˆè‰¯å¥½çš„ä»£ç è§„èŒƒæ˜¯æ¯ä¸ªç¨‹åºå‘˜çš„å¿…ä¿®è¯¾ï¼


